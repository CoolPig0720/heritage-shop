# 商品模块开发任务清单

## 阶段一：数据库设计与配置

### 1.1 数据库表结构
- [x] 设计商品表 `product`（名称、描述、价格、商家归属、状态、溯源与 3D 扩展字段）
- [x] 设计商品图片表 `product_image`（商品一对多、封面图、排序）
- [x] 更新数据库设计文档（`TODO/数据库设计.md`）并补充变更记录

### 1.2 初始化 SQL
- [x] 创建商品模块 SQL 脚本（`backend/src/main/resources/sql/product.sql`）
- [x] 插入模拟商品与商品图片数据

## 阶段二：后端实体层

### 2.1 商品实体
- [x] 创建 Product 实体类（字段映射、注解配置）
- [x] 创建 ProductMapper 接口（继承 BaseMapper）

### 2.2 商品图片实体
- [x] 创建 ProductImage 实体类（字段映射、注解配置）
- [x] 创建 ProductImageMapper 接口（继承 BaseMapper）

## 阶段三：后端业务逻辑层

### 3.1 DTO 类设计
- [x] 创建 ProductCreateRequest（新增商品：名称、描述、价格可选）
- [x] 创建 ProductUpdateRequest（更新商品：基础字段、状态、溯源、3D）
- [x] 创建 ProductVO（商品返回：封面、图片列表、时间字段）

### 3.2 Service 层
- [x] 创建 ProductService 接口及实现类
  - [x] createProduct(ProductCreateRequest) - 新增商品（仅管理员/商家）
  - [x] updateProduct(ProductUpdateRequest) - 更新商品（管理员全量/商家仅自己）
  - [x] deleteProduct(Long id) - 删除商品（管理员全量/商家仅自己）
  - [x] pageManageProducts(PageQuery) - 管理端分页查询（按角色过滤范围）
  - [x] getProductDetail(Long id) - 商品详情（包含封面与图片列表）
  - [x] getRandomOnSaleProducts(count) - 前台随机展示（仅上架商品）

### 3.3 业务规则与校验
- [x] 新增商品必填校验（name、description；price 为空按 999 处理）
- [x] 商家归属校验（MERCHANT 更新/删除/上下架需匹配 merchant_id）
- [x] 商品上下架规则（status: 1 上架 / 0 下架）
- [x] 删除商品级联处理（删除 product 时同步删除 product_image 记录）

## 阶段四：后端控制器层

### 4.1 管理端商品控制器
- [x] 创建 ProductController
  - [x] POST /api/products - 新增商品（ADMIN / MERCHANT）
  - [x] PUT /api/products/{id} - 修改商品（ADMIN / MERCHANT）
  - [x] DELETE /api/products/{id} - 删除商品（ADMIN / MERCHANT）
  - [x] GET /api/products - 管理端商品分页列表（ADMIN / MERCHANT）
  - [x] PUT /api/products/{id}/status - 商品上下架（ADMIN / MERCHANT）

### 4.2 前台商品展示控制器
- [x] 创建 ShopProductController
  - [x] GET /api/shop/recommend - 随机展示商品（所有登录用户）
  - [x] GET /api/shop/products/{id} - 商品详情（所有登录用户）

## 阶段五：前端 API 封装

### 5.1 管理端 API
- [x] 新增 src/api/product.js
  - [x] createProduct(data)
  - [x] updateProduct(id, data)
  - [x] deleteProduct(id)
  - [x] pageProducts(params)
  - [x] updateProductStatus(id, data)
  - [x] listProductImages(productId)
  - [x] addProductImages(productId, data)
  - [x] updateProductImage(imageId, data)
  - [x] deleteProductImage(imageId)

### 5.2 前台展示 API
- [x] 新增 src/api/shop.js
  - [x] getRecommendProducts(params)
  - [x] getProductDetail(id)

## 阶段六：前端页面开发

### 6.1 管理端商品管理页面对接
- [x] 对接 src/views/admin/Products.vue
  - [x] 列表分页查询对接后端
  - [x] 新增/编辑弹窗与表单校验
  - [x] 删除确认与删除接口对接
  - [x] 上下架开关对接

- [x] 对接 src/views/merchant/Products.vue
  - [x] 列表仅展示当前商家商品
  - [x] 新增商品默认 merchant_id 取当前登录用户
  - [x] 编辑/删除仅对自己商品生效（后端兜底校验）

### 6.2 前台商品页面（新增）
- [x] 新增前台商品页（随机展示）
  - [x] 页面路径：src/views/ShopProducts.vue
  - [x] 商品卡片：封面、名称、价格、描述摘要
  - [x] 点击跳转商品详情页

### 6.3 路由调整
- [x] 调整 /products 路由指向前台商品页（避免与管理端商品管理页混用）
- [x] 保持 /manage/products 与 /merchant/products 为管理端入口

### 6.4 商品详情页对接
- [x] 对接 src/views/ProductDetail.vue
  - [x] 详情接口对接（名称、描述、价格、溯源、3D、图片）
  - [x] 图片轮播与封面展示

## 阶段七：测试与优化

### 7.1 后端测试
- [ ] 测试管理员商品 CRUD
- [ ] 测试商家商品 CRUD 与归属校验
- [ ] 测试前台随机列表只返回上架商品
- [ ] 测试商品删除时图片记录同步删除

### 7.2 前端联调
- [ ] 管理端商品管理全流程联调（新增→编辑→上下架→删除）
- [ ] 前台商品页与详情页联调（列表→详情）

### 7.3 体验与性能
- [ ] 列表加载与空状态提示优化
- [ ] 请求失败提示与重试交互
- [ ] 随机推荐接口加缓存（可选）

---

## 变更记录

| 变更日期    | 变更内容 |
| ----------- | -------- |
| 2026-01-27  | 新建商品模块开发任务清单，按现有项目结构拆分后端与前端任务 |
| 2026-01-27  | 完成商品模块后端实现（实体/DTO/Service/Controller），并通过 mvn compile 与 mvn test |
| 2026-01-28  | 完成商品模块前端 API 封装与商品管理/前台页面路由对接，更新任务清单勾选项 |
