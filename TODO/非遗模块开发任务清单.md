# 非遗模块开发任务清单

## 阶段一：数据库设计与配置

### 1.1 数据库表结构落地
- [x] 提供非遗模块 5 张表建表 SQL（见 `backend/src/main/resources/sql/heritage.sql`）
  - [x] `heritage_category`
  - [x] `heritage_project`
  - [x] `heritage_project_media`
  - [x] `heritage_inheritor`
  - [x] `heritage_project_inheritor`

### 1.2 数据预置与模拟数据
- [x] 初始化分类、项目、媒体、传承人、关联关系模拟数据
- [x] 确认 `media_type` 与 `sort_order` 的使用规范（展示图/流程图/视频）

---

## 阶段二：后端实体层

### 2.1 实体类（Entity）
- [x] 创建 `HeritageCategory` 实体类
- [x] 创建 `HeritageProject` 实体类
- [x] 创建 `HeritageProjectMedia` 实体类
- [x] 创建 `HeritageInheritor` 实体类
- [x] 创建 `HeritageProjectInheritor` 实体类

### 2.2 Mapper（MyBatis-Plus）
- [x] 创建 `HeritageCategoryMapper`（继承 BaseMapper）
- [x] 创建 `HeritageProjectMapper`（继承 BaseMapper）
- [x] 创建 `HeritageProjectMediaMapper`（继承 BaseMapper）
- [x] 创建 `HeritageInheritorMapper`（继承 BaseMapper）
- [x] 创建 `HeritageProjectInheritorMapper`（继承 BaseMapper）

---

## 阶段三：后端业务逻辑层

### 3.1 DTO / VO 设计
- [ ] 创建 `HeritageProjectQuery`（列表筛选：地区/公布时间/类别/类型/关键词 + 分页）
- [x] 创建 `HeritageProjectListItemVO`（列表返回字段）
- [x] 创建 `HeritageProjectDetailVO`（项目详情返回：基础信息/介绍/媒体/传承人）
- [x] 创建 `HeritageInheritorDetailVO`（传承人详情返回：基础信息/介绍/关联项目）
- [x] 创建管理端 VO：`HeritageInheritorAdminVO`（管理端传承人字段）
- [x] 创建管理端 DTO：`HeritageProjectCreateRequest` / `HeritageProjectUpdateRequest` / `HeritageProjectInheritorsUpdateRequest` / `HeritageCategoryCreateRequest` / `HeritageInheritorCreateRequest` / `HeritageInheritorUpdateRequest`
- [x] 创建管理端媒体 DTO：`HeritageProjectMediaCreateRequest` / `HeritageProjectMediaUpdateRequest`

### 3.2 Service 层
- [x] 创建 `HeritageCategoryService`（分类树）
  - [x] getCategoryTree() - 获取分类树
  - [x] createCategory() - 新增类型（管理端）
- [x] 创建 `HeritageProjectService`（项目列表与详情）
  - [x] pageProjects(PageQuery, categoryId) - 项目分页查询（keyword/categoryId）
  - [x] getProjectDetail(Long projectId) - 项目详情
  - [x] createProject()/updateProject()/deleteProject() - 管理端项目增删改
  - [x] updateProjectInheritors(Long projectId, inheritorIds) - 更新项目传承人（管理端）
  - [x] addProjectMedia()/updateProjectMedia()/deleteProjectMedia() - 管理端项目媒体增删改
- [x] 创建 `HeritageInheritorService`（传承人详情与管理）
  - [x] getInheritorDetail(Long inheritorId) - 传承人详情
  - [x] pageAdminInheritors(PageQuery) - 传承人分页（管理员）
  - [x] getAdminInheritor(Long inheritorId) - 传承人详情（管理员）
  - [x] createInheritor()/updateInheritor()/deleteInheritor() - 管理端传承人增删改

---

## 阶段四：后端控制器层

### 4.1 非遗公开接口（面向展示）
- [x] 创建 `HeritageCategoryController`
  - [x] GET `/api/heritage/categories/tree` - 分类树
- [x] 创建 `HeritageProjectController`
  - [x] GET `/api/heritage/projects` - 项目列表分页与筛选
  - [x] GET `/api/heritage/projects/{id}` - 项目详情
- [x] 创建 `HeritageInheritorController`
  - [x] GET `/api/heritage/inheritors/{id}` - 传承人详情

### 4.2 非遗管理端接口（管理员）
- [x] 创建 `HeritageAdminCategoryController`
  - [x] GET `/api/admin/heritage/categories/tree` - 分类树（管理员）
  - [x] POST `/api/admin/heritage/categories` - 新增类型（管理员）
- [x] 创建 `HeritageAdminProjectController`
  - [x] GET `/api/admin/heritage/projects` - 项目分页（管理员）
  - [x] GET `/api/admin/heritage/projects/{id}` - 项目详情（管理员）
  - [x] POST `/api/admin/heritage/projects` - 新增项目（管理员）
  - [x] PUT `/api/admin/heritage/projects/{id}` - 更新项目（管理员）
  - [x] PUT `/api/admin/heritage/projects/{id}/inheritors` - 更新项目传承人（管理员）
  - [x] POST `/api/admin/heritage/projects/{id}/medias` - 新增项目媒体（管理员）
  - [x] PUT `/api/admin/heritage/projects/medias/{mediaId}` - 更新项目媒体（管理员）
  - [x] DELETE `/api/admin/heritage/projects/medias/{mediaId}` - 删除项目媒体（管理员）
  - [x] DELETE `/api/admin/heritage/projects/{id}` - 删除项目（管理员）
- [x] 创建 `HeritageAdminInheritorController`
  - [x] GET `/api/admin/heritage/inheritors` - 传承人分页（管理员）
  - [x] GET `/api/admin/heritage/inheritors/{id}` - 传承人详情（管理员）
  - [x] POST `/api/admin/heritage/inheritors` - 新增传承人（管理员）
  - [x] PUT `/api/admin/heritage/inheritors/{id}` - 更新传承人（管理员）
  - [x] DELETE `/api/admin/heritage/inheritors/{id}` - 删除传承人（管理员）

---

## 阶段五：前端 API 封装

### 5.1 API 接口封装
- [x] 创建 `frontend/src/api/heritage.js`
  - [x] getHeritageCategoryTree() - 分类树
  - [x] pageHeritageProjects(params) - 项目列表分页
  - [x] getHeritageProjectDetail(id) - 项目详情
  - [x] getHeritageInheritorDetail(id) - 传承人详情
  - [x] getAdminHeritageCategoryTree() / createAdminHeritageCategory() - 管理端类型（分类）
  - [x] pageAdminHeritageProjects() / getAdminHeritageProjectDetail() / createAdminHeritageProject() / updateAdminHeritageProject() / deleteAdminHeritageProject() - 管理端项目 CRUD
  - [x] updateAdminHeritageProjectInheritors() - 管理端项目传承人更新
  - [x] createAdminHeritageProjectMedia() / updateAdminHeritageProjectMedia() / deleteAdminHeritageProjectMedia() - 管理端项目媒体管理
  - [x] pageAdminHeritageInheritors() / getAdminHeritageInheritorDetail() / createAdminHeritageInheritor() / updateAdminHeritageInheritor() / deleteAdminHeritageInheritor() - 管理端传承人 CRUD

---

## 阶段六：前端页面开发

### 6.1 非遗列表页（对应原型图1）
- [ ] 列表筛选区：所属地区 / 公布时间 / 类别 / 类型 / 关键字（项目名称）
- [x] 已实现筛选：类型 / 关键字（项目名称）
- [ ] 数据统计展示：批次/类别/项目/子项（可先用接口返回的聚合值或 mock）
- [ ] 项目列表表格：序号/项目序号/编号/名称/类别/公布时间/类型/申报地区或单位/保护单位
- [ ] 点击项目名称跳转项目详情页

### 6.2 项目详情页（对应原型图2）
- [x] 项目详情页基础展示（基础信息 + description）
- [x] 媒体列表返回（按 `sort_order` 排序）与页面展示框架已就位
- [x] 工艺流程展示（`media_type=PROCESS_IMAGE`，按 sort_order 排序）
- [x] 视频展示（`media_type=VIDEO`，可无）
- [x] 相关传承人列表（点击跳转传承人详情）
- [x] 管理端详情页支持上传/删除展示图、工艺流程图、工艺视频

### 6.3 传承人详情页（对应原型图3）
- [x] 传承人基础信息：姓名/性别/出生日期/民族/照片
- [x] 详细介绍（description）
- [x] 关联项目列表（可跳转项目详情）

### 6.4 管理端非遗管理页（管理员）
- [x] 管理端路由：`/manage/heritage`（requiresAdmin）
- [x] 管理端入口：Header 头像下拉新增「非遗管理」
- [x] 项目管理：分页/类型筛选/关键词搜索/新增/编辑/删除
- [x] 项目传承人维护：编辑项目时支持选择传承人并保存
- [x] 类型管理：新增类型（支持选择上级类型、设置排序）
- [x] 传承人管理：分页/关键词搜索/新增/编辑/删除
- [x] 管理端列表跳转详情：携带 `from=manage` 支持详情页返回管理端

---

## 阶段七：测试与优化

### 7.1 功能测试
- [ ] 测试分类树加载
- [ ] 测试项目列表筛选与分页
- [ ] 测试项目详情展示（展示图/流程图/视频）
- [ ] 测试传承人详情与关联项目展示

### 7.2 异常与边界测试
- [ ] 测试无媒体/无视频/无关联传承人时页面表现
- [ ] 测试空结果筛选与无数据提示
- [ ] 测试参数非法（id 不存在）错误提示

### 7.3 性能优化
- [ ] 列表页筛选项缓存（分类树等可缓存）
- [ ] 列表查询索引验证（category_id、project_id+media_type 等）

---

## 阶段八：注意事项

1. **表名规范**：表名不使用 `t_` 前缀
2. **时间字段**：非遗模块表结构不包含 `create_time`
3. **媒体存储**：图片/视频以 URL 方式存储，前端按 `media_type` 区分展示区块
4. **排序规则**：媒体展示与流程顺序依赖 `sort_order`（数值越小越靠前）

