# 后端系统设计与实现说明

（基于 Spring Boot）

---

## 一、后端总体设计

### 1.1 后端设计目标

后端系统主要负责：

1. 提供统一的业务接口服务（RESTful API）
2. 实现用户认证与多角色权限控制
3. 管理非遗商品、文化内容及定制流程数据
4. 对接第三方智能定制服务（阿里云大模型 API）
5. 保证系统数据的安全性、一致性与可扩展性

---

### 1.2 后端技术选型

| 技术                       | 用途说明              |
| ------------------------ | ----------------- |
| Spring Boot              | 后端主框架，负责业务逻辑与接口实现 |
| Spring MVC               | 构建 RESTful API    |
| Spring Security（或自定义拦截器） | 用户认证与权限控制         |
| JPA / MyBatis            | 数据持久层访问           |
| MySQL                    | 关系型数据库            |
| JSON                     | 前后端数据交互格式         |

---

## 二、后端整体架构设计

### 2.1 分层架构设计

后端采用典型的**分层架构模式**，各层职责清晰，避免业务逻辑混乱。

```
Controller 层（接口层）
        ↓
Service 层（业务逻辑层）
        ↓
Repository / Mapper 层（数据访问层）
        ↓
MySQL 数据库
```

#### 各层职责说明

* **Controller 层**

  * 接收前端请求
  * 参数校验
  * 返回统一格式的响应数据

* **Service 层**

  * 处理核心业务逻辑
  * 进行权限和业务规则判断
  * 调用数据访问层或第三方服务

* **Repository / Mapper 层**

  * 负责数据库 CRUD 操作
  * 不包含业务逻辑

---

## 三、后端包结构设计（非常重要）

### 3.1 推荐包结构

```text
com.example.heritage
├── controller        // 接口层
├── service           // 业务层
│   └── impl
├── repository        // 数据访问层（JPA）
│   或 mapper         //（MyBatis）
├── entity            // 实体类
├── dto               // 数据传输对象
├── config            // 配置类
├── security          // 权限与认证相关
├── common            // 通用返回、工具类
└── HeritageApplication.java
```

> 📌 这个结构**非常适合 Trae / AI 编程**，也非常“老师眼熟”。

---

## 四、核心模块后端设计

下面严格按照你前面定义的**功能模块顺序**来设计后端。

---

## 五、用户基础模块（后端设计）

### 5.1 注册登录模块

#### 5.1.1 模块职责

* 用户注册
* 用户登录认证
* 登录状态维护
* 用户角色识别

---

#### 5.1.2 涉及核心实体

* User（用户实体）

  * id
  * username
  * password
  * role（ADMIN / MERCHANT / USER）
  * status
  * createTime

---

#### 5.1.3 接口设计思路（不写代码）

| 接口功能  | 接口职责            |
| ----- | --------------- |
| 用户注册  | 校验用户名唯一性并保存用户   |
| 用户登录  | 校验用户名和密码，返回登录状态 |
| 验证码获取 | 防止恶意登录          |
| 密码重置  | 修改用户密码          |

---

#### 5.1.4 权限设计说明

* 登录后生成登录凭证（如 Token / Session）
* 请求接口前进行统一拦截
* 根据用户角色控制接口访问权限

---

### 5.2 个人中心模块

#### 模块职责

* 获取当前登录用户信息
* 修改个人信息
* 修改密码

#### 实现说明

* 后端通过登录状态获取当前用户 ID
* 所有操作仅允许用户操作自己的数据
* 管理员不可直接通过该模块修改他人信息

---

### 5.3 用户管理模块（管理员）

#### 模块职责

* 查询用户列表
* 新增 / 修改 / 删除用户
* 管理用户角色

#### 权限说明

* 仅管理员角色可访问
* 所有接口需进行权限校验

---

## 六、商品管理模块（后端设计）

### 6.1 模块职责

* 非遗商品信息维护
* 商品上下架管理
* 商品与商家绑定

---

### 6.2 核心实体设计思路

* Product（商品）

  * id
  * name
  * price
  * description
  * category（非遗类别）
  * merchantId
  * status
  * traceCode

---

### 6.3 权限控制设计

| 角色   | 权限      |
| ---- | ------- |
| 管理员  | 管理所有商品  |
| 商家   | 仅管理自己商品 |
| 普通用户 | 仅查询     |

---

### 6.4 接口设计要点

* 新增商品时绑定当前商家 ID
* 修改、删除商品时校验商品归属
* 查询接口支持条件筛选（名称、商家、类别）

---

## 七、商城展示模块（后端支持）

### 7.1 商品列表接口

#### 模块职责

* 返回商品列表
* 支持分页与条件查询

#### 实现要点

* 不返回下架商品
* 支持模糊搜索
* 支持按非遗类别过滤

---

### 7.2 商品详情接口

#### 模块职责

* 返回商品详细信息
* 返回三维展示资源地址
* 返回溯源码信息

---

## 八、非遗文化内容模块（后端设计）

### 8.1 模块职责

* 非遗文化内容展示
* 非遗项目与商品关联

---

### 8.2 核心实体设计思路

* HeritageProject（非遗项目）

  * id
  * name
  * category
  * description
  * process
  * inheritor

---

### 8.3 权限设计

* 查询接口：所有用户可访问
* 管理接口：仅管理员可访问

---

## 九、智能定制模块（后端设计）

### 9.1 模块职责

* 接收用户定制需求
* 转换为智能生成参数
* 调用第三方大模型接口
* 返回生成结果

---

### 9.2 定制流程后端设计

1. 接收用户输入参数
2. 校验参数合法性
3. 组装定制请求数据
4. 调用阿里云智能生成 API
5. 保存定制记录
6. 返回生成图片信息

---

### 9.3 定制子模块（用户-商家）

#### 模块职责

* 保存定制订单信息
* 维护定制状态
* 支持用户与商家沟通记录

---

## 十、公共模块设计

### 10.1 统一返回结果

后端接口统一返回结构，便于前端处理：

* 状态码
* 提示信息
* 数据对象

---

### 10.2 异常处理设计

* 统一异常捕获
* 返回友好错误信息
* 避免后端异常直接暴露

---

## 十一、后端设计小结

本后端系统通过模块化、分层化设计，实现了用户管理、商品管理、文化内容展示以及智能定制等核心功能。系统结构清晰，职责明确，为后续功能扩展与系统优化提供了良好基础。

---

## 十二、给你的下一步“非常具体”的建议

你现在**最适合按这个顺序继续**：

1️⃣ 先实现 **用户模块（登录 + 权限）**
2️⃣ 再实现 **商品管理模块**
3️⃣ 然后补充 **非遗文化模块**
4️⃣ 最后接入 **智能定制模块**
