# 一、数据库设计说明

本系统数据库采用 **MySQL** 关系型数据库进行设计。
在数据库设计过程中，遵循以下原则：

* **规范性原则**：表结构符合第三范式，减少数据冗余
* **扩展性原则**：支持后续功能模块扩展，如智能定制、溯源信息等
* **安全性原则**：敏感信息（如密码）采用加密存储
* **角色分离原则**：通过角色字段与权限控制实现多角色管理

数据库主要服务于用户管理、实名认证等核心功能模块。

---

# 二、数据库表总体划分

| 模块   | 数据表                                                        |
| ---- | ---------------------------------------------------------- |
| 用户基础 | `sys_user`、`certificate`                                         |
| 商品模块 | `product`、`product_image`                                     |   
| 地址模块 | `user_address`                                                |

---

# 三、核心数据表结构设计（字段级）

---

## 3.1 用户表 `sys_user`

用户表存储用户的基本信息和认证信息。

| 字段名             | 类型           | 长度 | 允许空 | 默认值         | 说明                          |
| ---------------- | ------------ | ------ | -------- | ------------ | --------------------------- |
| id              | BIGINT PK     | -      | 否       | -            | 用户ID，主键，自增              |
| account          | VARCHAR       | 50     | 否       | -            | 账号，用于登录，唯一索引         |
| password         | VARCHAR       | 255    | 否       | -            | 密码，BCrypt 加密              |
| name            | VARCHAR       | 50     | 否       | -            | 名称，用户可修改                |
| role            | VARCHAR       | 20     | 否       | USER         | 角色：ADMIN-管理员，USER-普通用户，MERCHANT-商家 |
| avatar          | VARCHAR       | 255    | 是       | NULL         | 头像 URL                      |
| certificate_number | VARCHAR       | 100    | 是       | NULL         | 证件号，实名认证后填充，唯一索引   |
| register_time    | DATETIME      | -      | 否       | CURRENT_TIMESTAMP | 注册时间                        |

**索引设计：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_account` (`account`)
- UNIQUE KEY `uk_certificate_number` (`certificate_number`)
- KEY `idx_role` (`role`)

**字段说明：**
- `account`：用户登录账号，4-20 位，字母数字下划线，全局唯一
- `password`：用户密码，8-20 位，至少包含字母和数字，使用 BCrypt 加密存储
- `name`：用户显示名称，2-20 位，中文或英文，用户可以自己修改
- `role`：用户角色，注册时选择，ADMIN（管理员）、USER（普通用户）、MERCHANT（商家）
- `avatar`：用户头像 URL，可为空
- `certificate_number`：证件号，实名认证后填充，可为空，全局唯一
- `register_time`：注册时间

---

## 3.2 证件表 `certificate`

证件表存储预置的合法证件信息，用于实名认证验证。

| 字段名             | 类型           | 长度 | 允许空 | 默认值 | 说明                          |
| ---------------- | ------------ | ------ | -------- | -------- | --------------------------- |
| id              | BIGINT PK     | -      | 否       | -       | 证件ID，主键，自增              |
| certificate_number | VARCHAR       | 100    | 否       | -       | 证件号，唯一索引                |
| name            | VARCHAR       | 50     | 否       | -       | 真实姓名                      |
| role            | VARCHAR       | 20     | 否       | -       | 角色：ADMIN-管理员，USER-普通用户，MERCHANT-商家 |

**索引设计：**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_certificate_number` (`certificate_number`)
- KEY `idx_role` (`role`)

**字段说明：**
- `certificate_number`：证件号，全局唯一
- `name`：真实姓名，与证件号一一对应
- `role`：证件对应的角色，ADMIN、USER 或 MERCHANT

---

## 3.3 证件号格式

证件号使用更真实的格式：

#### 3.3.1 管理员证件号
- **格式**：`ADMIN{序号}`
- **示例**：`ADMIN0001`、`ADMIN0002`
- **说明**：
  - `ADMIN` 固定前缀
  - `0000` 为 4 位序号，从 0000 开始递增

#### 3.3.2 商家证件号
- **格式**：`MERCHANT{序号}`
- **示例**：`MERCHANT0001`、`MERCHANT0002`、`MERCHANT0003`
- **说明**：
  - `MERCHANT` 固定前缀
  - `0001` 为 4 位序号，从 0001 开始递增

#### 3.3.3 普通用户证件号
- **格式**：`USER{序号}`
- **示例**：`USER0001`、`USER0002`、`USER0003`
- **说明**：
  - `USER` 固定前缀
  - `0001` 为 4 位序号，从 0001 开始递增

---

## 3.4 实名认证流程

1. **用户提交认证**
   - 用户输入证件号和真实姓名
   - 系统在证件表中查找匹配的记录
   - 如果找到证件号和名称都匹配的记录，且该证件号未被其他用户使用，则认证成功
   - 认证成功后，将证件号更新到用户表的 certificate_number 字段
   - 如果证件号和名称不匹配，或证件号已被其他用户使用，则认证失败

2. **认证完成**
   - 用户可以在个人中心查看认证状态
   - 认证成功后，用户可以进行相应的业务操作（如商家发布商品）

---

## 3.5 商品表 `product`

| 字段名           | 类型        | 长度  | 允许空 | 默认值            | 说明                                       |
| ---------------- | ----------- | ----- | ------ | ----------------- | ------------------------------------------ |
| id               | BIGINT PK   | -     | 否     | -                 | 商品ID，主键，自增                         |
| name             | VARCHAR     | 100   | 否     | -                 | 商品名称                                   |
| description      | TEXT        | -     | 否     | -                 | 商品描述                                   |
| price            | DECIMAL     | 10,2  | 否     | -                 | 商品价格                                   |
| merchant_id      | BIGINT      | -     | 否     | -                 | 商家用户ID（关联 `sys_user.id`）           |
| trace_code       | VARCHAR     | 100   | 是     | NULL              | 商品溯源码（模拟功能）                     |
| trace_qr_url     | VARCHAR     | 255   | 是     | NULL              | 溯源码二维码图片URL（模拟功能）            |
| model_3d_url     | VARCHAR     | 255   | 是     | NULL              | 商品3D模型地址（如 .glb / .gltf）         |
| status           | TINYINT     | 1     | 否     | 1                 | 商品状态：1-上架，0-下架                   |
| create_time      | DATETIME    | -     | 否     | CURRENT_TIMESTAMP | 创建时间                                   |
| update_time      | DATETIME    | -     | 否     | CURRENT_TIMESTAMP | 更新时间（自动更新）                        |

**索引设计：**
- PRIMARY KEY (`id`)
- KEY `idx_merchant_id` (`merchant_id`)
- KEY `idx_status` (`status`)

**字段说明补充：**
- `merchant_id`：指向用户表 `sys_user.id`，商家（MERCHANT）或管理员（ADMIN）均可关联
- `trace_code`、`trace_qr_url`：仅用于模拟溯源功能，可为空，不承担实际业务校验
- `model_3d_url`：存储 3D 模型文件的访问地址（如 .glb、.gltf）

---

## 3.6 商品图片表 `product_image`

| 字段名       | 类型      | 长度 | 允许空 | 默认值            | 说明                         |
| ------------ | --------- | ---- | ------ | ----------------- | ---------------------------- |
| id           | BIGINT PK | -    | 否     | -                 | 商品图片ID，主键，自增       |
| product_id   | BIGINT    | -    | 否     | -                 | 商品ID                       |
| image_url    | VARCHAR   | 255  | 否     | -                 | 商品图片URL                  |
| sort_order   | INT       | -    | 否     | 0                 | 图片排序，数值越小越靠前     |
| is_cover     | TINYINT   | 1    | 否     | 0                 | 是否封面图：1-是，0-否       |
| create_time  | DATETIME  | -    | 否     | CURRENT_TIMESTAMP | 创建时间                     |

**索引设计：**
- PRIMARY KEY (`id`)
- KEY `idx_product_id` (`product_id`)
- KEY `idx_product_cover` (`product_id`, `is_cover`)

**字段说明补充：**
- `product_id` 与 `product.id` 形成一对多关系
- `is_cover` 用于商品列表页展示主图
- `sort_order` 用于商品详情页图片轮播顺序

---

## 3.7 收货地址表 `user_address`

收货地址表用于存储用户的收货地址信息，同一用户可以维护多条地址，并支持设置默认地址。
为适配港澳等非三级行政区以及海外地区，地址地区采用「路径」方式存储（/ 分隔），并保留前三段冗余字段用于快速展示与兼容。

| 字段名            | 类型        | 长度  | 允许空 | 默认值            | 说明                                  |
| ----------------- | ----------- | ----- | ------ | ----------------- | ------------------------------------- |
| id                | BIGINT PK   | -     | 否     | -                 | 地址ID，主键，自增                    |
| user_id           | BIGINT      | -     | 否     | -                 | 用户ID（关联 `sys_user.id`）          |
| receiver_name     | VARCHAR     | 50    | 否     | -                 | 收货人姓名                            |
| receiver_phone    | VARCHAR     | 20    | 否     | -                 | 收货人手机号                          |
| region_code_path  | VARCHAR     | 512   | 是     | NULL              | 地区编码路径（/ 分隔，可空以支持海外） |
| region_name_path  | VARCHAR     | 512   | 否     | -                 | 地区名称路径（/ 分隔）                |
| region_depth      | INT         | -     | 否     | 0                 | 地区层级深度                          |
| province          | VARCHAR     | 50    | 是     | NULL              | 冗余：第1级名称                       |
| city              | VARCHAR     | 50    | 是     | NULL              | 冗余：第2级名称                       |
| district          | VARCHAR     | 50    | 是     | NULL              | 冗余：第3级名称                       |
| detail_address    | VARCHAR     | 255   | 否     | -                 | 详细地址                              |
| is_default        | TINYINT     | 1     | 否     | 0                 | 是否默认地址：1-是，0-否              |
| status            | TINYINT     | 1     | 否     | 1                 | 状态字段（预留）                      |
| create_time       | DATETIME    | -     | 否     | CURRENT_TIMESTAMP | 创建时间                              |
| update_time       | DATETIME    | -     | 否     | CURRENT_TIMESTAMP | 更新时间（自动更新）                  |

**索引设计：**
- PRIMARY KEY (`id`)
- KEY `idx_user_id` (`user_id`)
- KEY `idx_user_default` (`user_id`, `is_default`)
- KEY `idx_user_region_depth` (`user_id`, `region_depth`)

**字段说明补充：**
- `region_name_path`：地区名称路径，按层级用 `/` 分隔（示例：`北京市/北京市/东城区`、`香港特别行政区/九龙`）。
- `province/city/district`：冗余前三段，用于快速展示与兼容旧逻辑；若地区层级不足 3 段，缺失部分为空。
- `is_default`：同一用户同一时刻最多一条为默认地址（业务层保证）。

---

# 四、表关系说明（ER 逻辑）

```
sys_user (1) —— (N) product
product (1) —— (N) product_image  
sys_user (1) —— (N) certificate
sys_user (1) —— (N) user_address
```

---

# 五、实现与论文写作建议（非常重要）

### 实现顺序建议（照着做不容易翻车）

1. `sys_user`
2. `product`
3. `product_image`        
4. `certificate`
5. `user_address`
6. 其余表按需补充

### 论文中可直接使用的表述

> 本系统数据库结构围绕用户管理、实名认证业务进行设计，各功能模块通过外键建立关联，既保证了数据一致性，又为系统扩展提供了良好的基础。

---

# 六、变更记录

## 变更记录

| 变更日期       | 变更内容                                                                 |
| -------------- | -------------------------------------------------------------------- |
| 2026-01-20    | 1. 清除所有未进行的数据库表设计（商品表、非遗表、定制表等）<br>2. 更新用户表 `sys_user` 结构，新增字段：account、certificate_number、register_time<br>3. 更新证件表 `certificate` 结构，新增字段：role<br>4. 添加证件号格式说明（ADMIN、MERCHANT、USER）<br>5. 添加实名认证流程说明 |
| 2026-01-27    | 新增商品模块表结构：`product`、`product_image`；补充商品与图片关系说明与索引设计；更新实现顺序建议 |
| 2026-01-29    | 新增地址模块表结构：`user_address`；采用地区路径字段以支持多级行政区与海外 |
