# 用户模块开发任务清单

## 阶段一：数据库设计与配置

### 1.1 数据库配置
- [x] 检查并配置数据库连接（后端 application.yml）
- [x] 修改用户表结构设计（根据新需求调整字段）
- [x] 设计证件表结构（实名认证功能）

### 1.2 数据库表结构
- [x] 更新 User 表字段（ID、账号、密码、名称、角色、头像、证件号、注册时间）
- [x] 创建 Certificate 表（ID、名称、证件号、角色）

## 阶段二：后端实体层

### 2.1 用户实体
- [x] 创建 User 实体类（包含字段映射、注解配置）
- [x] 创建 UserMapper 接口（继承 BaseMapper）

### 2.2 证件实体
- [x] 创建 Certificate 实体类（证件表）
- [x] 创建 CertificateMapper 接口（继承 BaseMapper）

## 阶段三：后端业务逻辑层

### 3.1 DTO 类设计
- [x] 创建 LoginRequest（登录请求：账号、密码）
- [x] 创建 RegisterRequest（注册请求：账号、密码、名称）
- [x] 创建 UserVO（用户信息返回）
- [x] 创建 UserUpdateRequest（用户信息更新）
- [x] 创建 PasswordUpdateRequest（密码修改）
- [x] 创建 CertificateRequest（实名认证请求）

### 3.2 Service 层
- [x] 创建 UserService 接口及实现类（业务逻辑层）
  - [x] register(RegisterRequest) - 用户注册
  - [x] login(LoginRequest) - 用户登录
  - [x] getUserInfo(Long userId) - 获取用户信息
  - [x] updateUserInfo(UserUpdateRequest) - 更新用户信息
  - [x] updatePassword(PasswordUpdateRequest) - 修改密码
  - [x] getUserList(PageQuery) - 获取用户列表（管理员）
  - [x] deleteUser(Long userId) - 删除用户

- [x] 创建 CertificateService 接口及实现类（实名认证逻辑）
  - [x] verifyCertificate(Long userId, CertificateRequest) - 实名认证
  - [x] getCertificateInfoByUserId(Long userId) - 获取认证信息
  - [x] getCertificateInfo(String certificateNumber) - 根据证件号获取信息
  - [x] updateCertification(Long userId, CertificateRequest) - 更新认证信息

## 阶段四：后端安全配置

### 4.1 JWT 工具类
- [x] 创建 JwtUtil 工具类
  - [x] generateToken(UserDetails) - 生成 Token
  - [x] parseToken(String) - 解析 Token
  - [x] validateToken(String) - 验证 Token
  - [x] getUsernameFromToken(String) - 从 Token 获取用户名

### 4.2 Spring Security 配置
- [x] 创建 SecurityConfig 配置类
  - [x] 配置密码编码器（BCrypt）
  - [x] 配置 JWT 过滤器
  - [x] 配置请求授权规则
    - [x] /api/auth/** - 允许匿名访问
    - [x] /api/certificate - 需要认证
    - [x] /api/user/profile - 需要认证
    - [x] /api/user/** - 需要认证 + 角色权限
  - [x] 配置异常处理

### 4.3 JWT 认证过滤器
- [x] 创建 JwtAuthenticationFilter
  - [x] 从请求头获取 Token
  - [x] 验证 Token 有效性
  - [x] 设置 SecurityContext

## 阶段五：后端控制器层

### 5.1 认证控制器
- [x] 创建 AuthController
  - [x] POST /api/auth/register - 用户注册
  - [x] POST /api/auth/login - 用户登录

### 5.2 用户控制器
- [x] 创建 UserController
  - [x] GET /api/user/profile - 获取当前用户信息
  - [x] PUT /api/user/profile - 更新当前用户信息
  - [x] PUT /api/user/password - 修改密码
  - [x] GET /api/user/list - 获取用户列表（管理员）
  - [x] PUT /api/user/{id}/status - 修改用户状态（管理员）
  - [x] DELETE /api/user/{id} - 删除用户（管理员）

### 5.3 实名认证控制器
- [x] 创建 CertificateController
  - [x] POST /api/certificate - 提交实名认证
  - [x] GET /api/certificate - 获取认证信息
  - [x] PUT /api/certificate - 更新认证信息
  - [x] GET /api/certificate/{certificateNumber} - 根据证件号获取信息

## 阶段六：前端 API 封装

### 6.1 API 接口封装
- [x] 创建 api/auth.js
  - [x] login(data) - 登录
  - [x] register(data) - 注册
  - [x] getProfile() - 获取个人信息
  - [x] updateProfile(data, id) - 更新个人信息
  - [x] updatePassword(data) - 修改密码
  - [x] getUserList(params) - 获取用户列表（管理员）
  - [x] deleteUser(id) - 删除用户
  - [x] updateUserStatus(id, data) - 更新用户状态
  - [x] verifyCertificate(data) - 提交实名认证
  - [x] getCertificateInfo() - 获取认证信息
  - [x] updateCertificate(data) - 更新认证信息

## 阶段七：前端页面开发

### 7.1 认证页面
- [x] 完善前端登录页面（对接后端登录接口）
  - [x] 表单：账号、密码
  - [x] 记住密码
  - [x] 登录按钮
  - [x] 跳转注册

- [x] 完善前端注册页面（对接后端注册接口）
  - [x] 表单：账号、密码、确认密码、名称、角色
  - [x] 表单验证
  - [x] 注册按钮
  - [x] 跳转登录

- [ ] 创建实名认证页面
  - [ ] 表单：真实姓名、证件号
  - [ ] 上传证件照片
  - [ ] 提交认证
  - [ ] 认证状态显示

### 7.2 用户中心页面
- [x] 完善前端个人中心页面（对接后端用户信息接口）
  - [x] Tab1：个人信息（账号、名称、头像、角色、证件号）
  - [x] Tab2：修改密码（原密码、新密码、确认密码）
  - [x] Tab3：实名认证（真实姓名、证件号、认证状态）

### 7.3 管理员页面
- [x] 用户管理页面
  - [x] 用户列表展示
  - [x] 用户搜索和筛选
  - [x] 添加用户
  - [x] 编辑用户
  - [x] 删除用户
  - [x] 管理员置顶显示
  - [x] 密码显示（占位符）
  - [x] 所有列居中
  - [x] 编辑用户时密码非必填
  - [x] 密码修改功能正常

## 阶段八：测试与优化

### 8.1 功能测试
- [x] 测试用户注册流程
- [x] 测试用户登录流程
- [x] 测试实名认证流程
- [x] 测试个人信息修改
- [x] 测试密码修改
- [x] 测试用户管理功能（管理员）
- [x] 测试管理员置顶功能
- [x] 测试密码编辑功能

### 8.2 集成测试
- [x] 测试用户模块完整流程（注册→登录→实名认证→个人信息管理）
- [x] 测试权限控制（普通用户、商家、管理员）
- [x] 测试 Token 过期处理
- [x] 测试异常情况处理

### 8.3 优化
- [x] 优化用户注册流程
- [x] 优化实名认证流程
- [x] 优化错误提示信息
- [x] 优化页面交互体验
- [x] 优化用户列表展示（管理员置顶、密码占位符）
- [x] 优化用户编辑体验（密码非必填）

## 阶段九：项目清理

### 9.1 冗余文件清理
- [x] 删除 TestController.java（测试控制器）
- [x] 删除前端根目录的 Products.vue
- [x] 删除前端根目录的 Heritage.vue
- [x] 更新路由配置，移除对已删除文件的引用

## 注意事项

1. **数据库连接**：确保 MySQL 数据库已启动，用户名密码正确
2. **密码安全**：使用 BCrypt 加密存储密码
3. **证件号生成规则**：
   - 商家：1-merchant0001-商家名称
   - 普通用户：2-user0001-用户名称
   - 管理员：不需要实名认证
4. **权限控制**：
   - 普通用户：只能访问个人相关接口
   - 商家：需要实名认证后才能发布商品
   - 管理员：可以访问所有用户管理接口
5. **Token 管理**：Token 有效期 7 天，存储在 localStorage
6. **输入验证**：
   - 账号：4-20 位，字母数字下划线
   - 密码：8-20 位，至少包含字母和数字
   - 名称：2-20 位，中文或英文
   - 证件号：根据角色生成唯一证件号

## 当前状态总结

### 已完成功能
✅ 用户注册和登录
✅ 个人信息管理（查看和修改）
✅ 密码修改功能
✅ 用户管理（管理员）
✅ 实名认证后端接口
✅ 实名认证前端页面（个人中心第三个Tab）
✅ 用户列表管理员置顶
✅ 密码编辑功能（支持修改和不修改）
✅ 实名认证流程完整测试
✅ 实名认证优化

### 待完成功能
无

### 已知问题
无

---

## 变更记录

| 变更日期       | 变更内容                                                                 |
| -------------- | -------------------------------------------------------------------- |
| 2026-01-20 15:45 | 1. 完成前端实名认证页面开发（个人中心第三个Tab）<br>2. 实现实名认证表单（证件号、真实姓名）<br>3. 实现认证状态显示（已认证/未认证）<br>4. 实现认证信息展示（证件号、真实姓名、角色）<br>5. 修复实名认证后个人信息未更新的问题<br>6. 更新任务清单，标记实名认证相关任务为已完成 |
| 2026-01-20 16:00 | 1. 完成记住密码功能<br>2. 在登录表单中添加记住密码复选框<br>3. 实现记住密码的 localStorage 存储逻辑<br>4. 实现页面加载时自动填充已保存的账号和密码<br>5. 更新任务清单，标记记住密码任务为已完成 |
